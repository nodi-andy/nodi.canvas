/**
            * @license
            * SPDX-License-Identifier: MIT
            */
!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((t="undefined"!=typeof globalThis?globalThis:t||self).nodicanvas={})}(this,(function(t){"use strict";class s{constructor(t,s){this.x=t||0,this.y=s||0}invert(){return this.x=-this.x,this.y=-this.y,this}add(t){return t instanceof s?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=t),this}subtract(t){return t instanceof s?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=t),this}multiply(t){return t instanceof s?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this}divide(t){return t instanceof s?(0!=t.x&&(this.x/=t.x),0!=t.y&&(this.y/=t.y)):0!=t&&(this.x/=t,this.y/=t),this}equals(t){return this.x==t.x&&this.y==t.y}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length(){return Math.sqrt(this.dot(this))}normalize(){return this.divide(this.length())}min(){return Math.min(this.x,this.y)}max(){return Math.max(this.x,this.y)}toAngles(){return-Math.atan2(-this.y,this.x)}angleTo(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}toArray(t){return[this.x,this.y].slice(0,t||2)}clone(){return new s(this.x,this.y)}set(t,s){return this.x=t,this.y=s,this}}s.invert=function(t){return new s(-t.x,-t.y)},s.add=function(t,i){return i instanceof s?new s(t.x+i.x,t.y+i.y):new s(t.x+i,t.y+i)},s.subtract=function(t,i){return i instanceof s?new s(t.x-i.x,t.y-i.y):new s(t.x-i,t.y-i)},s.multiply=function(t,i){return i instanceof s?new s(t.x*i.x,t.y*i.y):new s(t.x*i,t.y*i)},s.divide=function(t,i){return i instanceof s?new s(t.x/i.x,t.y/i.y):new s(t.x/i,t.y/i)},s.equals=function(t,s){return t.x==s.x&&t.y==s.y},s.dot=function(t,s){return t.x*s.x+t.y*s.y},s.cross=function(t,s){return t.x*s.y-t.y*s.x},s.distance=function(t,i){let e,h;t instanceof s==0&&(e=new s(t[0],t[1])),i instanceof s==0&&(h=new s(i[0],i[1]));const n=e.subtract(h);return Math.sqrt(n[0]*n[0]+n[1]*n[1])},s.getRandom=function(t,i){return new s(Math.getRandomInt(t),Math.getRandomInt(i))};class i{constructor(t){this.sx=1,this.sy=this.sx,this.tx=0,this.ty=0,this.dx=0,this.dy=0,this.scale=this.sx,t?.length&&(this.max_scale=t[0]),t?.length&&(this.min_scale=t[1]),this.enabled=!0,this.element=null}toWorld(t){return new s((t.x+this.tx)*this.scale,(t.y+this.ty)*this.scale)}toCanvas(t){return new s(this.tx+t.x/this.scale,this.ty+t.y/this.scale)}setTranslate(t,s){this.tx=t,this.ty=s}setScale(t,i){if(null!=this.min_scale&&t<this.min_scale?t=this.min_scale:null!=this.max_scale&&t>this.max_scale&&(t=this.max_scale),t!=this.scale){if(this.scale=t,i){var e=this.toCanvas(i);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var h=this.toCanvas(i),n=new s(h[0]-e[0],h[1]-e[1]);this.tx+=n.x,this.ty+=n.y}this.sx=this.sy=this.scale}}changeDeltaScale(t,s){this.setScale(this.scale*t,s)}reset(){this.scale=1,this.tx=0,this.ty=0}}class e extends i{constructor(t){super(),this.name=t,this.viewPort=new DOMRect(4),this.pointerevents_method="mouse",this.visible=!0}attachView(t){this.view=t,this.updateViewPort()}updateViewPort(){if(this.view){var t=this.tx-(this.view.tx+this.view.dx),s=this.ty-(this.view.ty+this.view.dy);this.viewPort.x=t,this.viewPort.y=s,this.viewPort.width=this.view.canvas.width*this.scale/this.view.scale,this.viewPort.height=this.view.canvas.height*this.scale/this.view.scale}}fillText(t,s){this.view.ctx.fillText(t,s.x+.25,s.y+.9)}onMouseClick(){return!1}onMouseDown(){return!1}onMouseUp(){return!1}render(){}}class h extends e{constructor(t){super(),this.game=t}render(){const t=this.game.ctx;t.setTransform(1,0,0,1,0,0),t.font="20px Arial",t.fillStyle="black",t.fillText("score: "+parseInt(this.game.point),30,30),this.msgText&&t.fillText(this.msgText,(this.game.viewPort.right-t.measureText(this.msgText).width)/2,30)}showMsg(t){this.msgText=t[0],setTimeout(this.removeText,t[1],this)}removeText(t){t.msgText=void 0}}class n extends e{constructor(t){super([10,.1]),super.view=this,this.layers={},this.dragable=!1,this.mouseStartCanvas=new s(0,0),this.mouseCurrentCanvas=new s(0,0),this.setCanvas(t),this.draggingCanvas=!1,this.pointerDown=!1,this.pointerIsDouble=!1,this.viewPort=new DOMRect,this.startRendering(),this.center=new s(0,0),this.zoomPoint=new s(0,0)}setCanvas(t){t&&t!==this.canvas&&(this.canvas=t,this.ctx=this.canvas.getContext("2d"),this._mousedown_callback=this.onMouseDown.bind(this),this._mousewheel_callback=this.onMouseWheel.bind(this),this._mousemove_callback=this.onMouseMove.bind(this),this._mouseup_callback=this.onMouseUp.bind(this),t.addEventListener("mousewheel",this._mousewheel_callback,!1),t.addEventListener("mousedown",this._mousedown_callback,!1),t.addEventListener("mouseup",this._mouseup_callback,!1),t.addEventListener("mousemove",this._mousemove_callback,!1),t.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),this._events_binded=!0)}getCanvasWindow(){if(!this.canvas)return window;var t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow}startRendering(){this.isRendering||(this.isRendering=!0,function t(){this.render();var s=this.getCanvasWindow();this.isRendering&&s.requestAnimationFrame(t.bind(this))}.call(this))}stopRendering(){this.isRendering=!1}onMouseDown(t){this.extendMouseData(t);let i=!1;for(const s in this.layers){const e=this.layers[s];i=i||e.onMouseDown(t)}if(0==i){var e=void 0===t.isPrimary||!t.isPrimary;this.mouseStartCanvas=new s(t.canvasX,t.canvasY),this.mouseCurrentCanvas=this.mouseStartCanvas.clone(),this.pointerDown&&e?this.pointerIsDouble=!0:this.pointerIsDouble=!1,this.pointerDown=!0,this.canvas.focus(),1==t.which&&!this.pointerIsDouble&&this.dragable&&(this.draggingCanvas=!0),this.isMouseDown=!0}}onMouseMove(t){this.extendMouseData(t),this.mouseCurrentCanvas.x=t.canvasX,this.mouseCurrentCanvas.y=t.canvasY;var s=this.mouseCurrentCanvas.subtract(this.mouseStartCanvas);return t.dragging=this.isMouseDown,this.draggingCanvas&&(this.dx=s.x*this.scale,this.dy=s.y*this.scale,this.updateViewRect()),t.preventDefault(),!1}onMouseUp(t){t.stopPropagation(),t.preventDefault(),this.extendMouseData(t),this.mouseCurrentCanvas.x=t.canvasX,this.mouseCurrentCanvas.y=t.canvasY;var s=this.mouseCurrentCanvas.subtract(this.mouseStartCanvas);let i=!1;for(const e in this.layers){const h=this.layers[e];h.onMouseUp(t),s.length()<.1&&h.onMouseClick(t),i=i||h.onMouseUp(t)}if(0==i&&this.draggingCanvas){var e=void 0===t.isPrimary||t.isPrimary;if(this.node_mouse_down=null,!e)return!1;this.tx+=s.x*this.scale,this.ty+=s.y*this.scale,this.dx=0,this.dy=0,this.isMouseDown=!1,this.last_click_position=null,this.draggingCanvas=!1,e&&(this.pointerDown=!1,this.pointerIsDouble=!1),this.last_mouse=this.mouseCurrentCanvas}return!1}onMouseWheel(t){var s=null!=t.wheelDeltaY?t.wheelDeltaY:-60*t.detail;this.extendMouseData(t);var i=this.scale;return s>0?i*=1.1:s<0&&(i*=1/1.1),this.setScale(i),t.preventDefault(),this.focusOn(),!1}extendMouseData(t){t.canvasX=(t.clientX-this.tx)/this.scale,t.canvasY=(t.clientY-this.ty)/this.scale,t.gridX=Math.floor(t.canvasX),t.gridY=Math.floor(t.canvasY)}addLayer(t){t&&(t.attachView(this),this.layers[t.name]=t),this.resize()}render(){if(0!=this.canvas?.width&&0!=this.canvas?.height){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="lightgray",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.sx,0,0,this.sy,this.tx+this.dx,this.ty+this.dy),this.grid&&this.grid.render(this);for(const t in this.layers){const s=this.layers[t];this.ctx.setTransform(this.sx,0,0,this.sy,this.tx+this.dx,this.ty+this.dy),this.ctx.transform(s.sx,0,0,s.sy,s.tx,s.ty),s.visible&&s.render(this)}this.hud&&this.hud.render()}}resize(t,s){if(!t&&!s){var i=this.canvas.parentNode;t=i.offsetWidth,s=i.offsetHeight}this.canvas.width==t&&this.canvas.height==s||(this.canvas.width=t,this.canvas.height=s,this.updateViewPort(),this.updateViewRect(),this.focusOn())}setScale(t){super.setScale(t)}setTranslate(t,s){this.tx=t,this.ty=s}focusOn(){const t=s.multiply(this.center,this.scale);this.tx=this.viewPort.x+this.viewPort.width/2-t.x,this.ty=this.viewPort.y+this.viewPort.height/2-t.y}setCenter(t,s){this.center.x=t,this.center.y=s,this.zoomPoint.x=t,this.zoomPoint.y=s}updateViewRect(){for(const t in this.layers){this.layers[t].updateViewPort()}}}"undefined"!=typeof window&&(window.__NODICANVAS__?console.warn("WARNING: Multiple instances of nodicanvas.js being imported."):window.__NODICANVAS__=1),t.NodiGrid=class extends e{constructor(t,i,e,h,n){super(t),this.gridSize=i,this.lineWidth=e,this.w=h,this.h=n,this.setScale(this.gridSize),this.mid=new s(this.w,this.h).divide(2)}worldToGrid(t,i){return new s(Math.floor(t/this.gridSize),Math.floor(i/this.gridSize))}screenToGrid(t,s){return this.worldToGrid(t,s)}render(t){t.ctx.strokeStyle="#555";const s=.1*this.viewPort.width,i=.1*this.viewPort.height;let e,h,n=0,a=0;0==this.w||null==this.w?(n=Math.floor(this.viewPort.x-s),e=n+this.viewPort.width+2*s):e=this.w,0==this.h||null==this.h?(a=Math.floor(this.viewPort.y-i),h=a+this.viewPort.height+2*i):h=this.h,t.ctx.shadowColor="black",t.ctx.shadowBlur=20,t.ctx.fillStyle="rgb(234, 234, 234)",t.ctx.fillRect(n,a,e,h),t.ctx.shadowColor="rgba(0,0,0,0)",t.ctx.lineWidth=this.lineWidth,t.ctx.beginPath();for(var r=n;r<=e;r+=1)t.ctx.moveTo(r,a),t.ctx.lineTo(r,h);for(var o=a;o<=h;o+=1)t.ctx.moveTo(n,o),t.ctx.lineTo(e,o);t.ctx.stroke()}},t.NodiHud=h,t.NodiLayer=e,t.NodiScene=class extends n{constructor(t){super(t),this.level=1,this.state="init",this.lastCell=1,this.point=0,super.hud=new h(this)}setGrid(t){this.grid=t}addHUD(t){this.hud=t}newLayer(t){const s=new e(t);return s.game=this,this.addLayer(s),s}reset(){this.point=0,this.level=1}},t.NodiView=n,t.Transformation=i,t.Vec2=s,t.getRandomInt=function(t){return Math.floor(Math.random()*t)},Object.defineProperty(t,"__esModule",{value:!0})}));
